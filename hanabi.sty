\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{hanabi}[2020/04/16 v1.0 A package for drawing Hanabi cards]

% Requirements
\RequirePackage{pgfkeys}
\RequirePackage{pgfopts}
\RequirePackage{scalerel}
\RequirePackage{xstring}

\RequirePackage{tikz}
	\usetikzlibrary{backgrounds,calc,shapes}
	
% Colours
\definecolor{red}{rgb}{1, 0, 0}
\definecolor{yellow}{rgb}{1, 1, 0}
\definecolor{green}{rgb}{0, 1, 0}
\definecolor{blue}{rgb}{0, 0, 1}
\definecolor{purple}{rgb}{0.5, 0, 1}
\definecolor{teal}{rgb}{0, 0.8, 0.8}

\definecolor{aqua}{rgb}{0.5, 1.0, 1.0}
\definecolor{cream}{rgb}{0.9, 0.9, 0.81}

% Symbols
\newsavebox{\redbox}
\savebox{\redbox}{\scalerel*{%
	\def\svgwidth{2 pt}%
	\import{symbols/}{red.pdf_tex}%
	}{X\rule[0ex]{0pt}{1pt}}%
}
\newcommand{\red}{\usebox{\redbox}}

\newsavebox{\yellowbox}
\savebox{\yellowbox}{\scalerel*{%
	\def\svgwidth{2 pt}%
	\import{symbols/}{yellow.pdf_tex}%
	}{X\rule[0ex]{0pt}{1pt}}%
}
\newcommand{\yellow}{\usebox{\yellowbox}}

\newsavebox{\greenbox}
\savebox{\greenbox}{\scalerel*{%
	\def\svgwidth{2 pt}%
	\import{symbols/}{green.pdf_tex}%
	}{X\rule[0ex]{0pt}{1pt}}%
}
\newcommand{\green}{\usebox{\greenbox}}

\newsavebox{\bluebox}
\savebox{\bluebox}{\scalerel*{%
	\def\svgwidth{2 pt}%
	\import{symbols/}{blue.pdf_tex}%
	}{X\rule[0ex]{0pt}{1pt}}%
}
\newcommand{\blue}{\usebox{\bluebox}}

\newsavebox{\purplebox}	
\savebox{\purplebox}{\scalerel*{%
	\def\svgwidth{2 pt}%
	\import{symbols/}{purple.pdf_tex}%
	}{X\rule[0ex]{0pt}{1pt}}%
}
\newcommand{\purple}{\usebox{\purplebox}}

\newsavebox{\tealbox}	
\savebox{\tealbox}{\scalerel*{%
	\def\svgwidth{2 pt}%
	\import{symbols/}{teal.pdf_tex}%
	}{X\rule[0ex]{0pt}{1pt}}%
}
\newcommand{\teal}{\usebox{\tealbox}}

\newsavebox{\blackbox}
\savebox{\blackbox}{\scalerel*{%
	\def\svgwidth{2 pt}%
	\import{symbols/}{black.pdf_tex}%
	}{X\rule[0ex]{0pt}{1pt}}%
}
\newcommand{\black}{\usebox{\blackbox}}

\newsavebox{\whitebox}		
\savebox{\whitebox}{\scalerel*{%
	\def\svgwidth{2 pt}%
	\import{symbols/}{white.pdf_tex}%
	}{X\rule[0ex]{0pt}{1pt}}%
}
\newcommand{\white}{\usebox{\whitebox}}

\newsavebox{\rainbowbox}	
\savebox{\rainbowbox}{\scalerel*{%
	\def\svgwidth{2 pt}%
	\import{symbols/}{rainbow.pdf_tex} }{X\rule[0ex]{0pt}{1pt}}%
}
\newcommand{\rainbow}{\usebox{\rainbowbox}}

\newsavebox{\zerobox}
\savebox{\zerobox}{\scalerel*{%
	\def\svgwidth{2 pt}%
	\import{symbols/}{zero.pdf_tex}%
	}{X\rule[0ex]{0pt}{1pt}}%
}
\newcommand{\zero}{\usebox{\zerobox}}

\newsavebox{\onebox}	
\savebox{\onebox}{\scalerel*{%
	\def\svgwidth{2 pt}%
	\import{symbols/}{one.pdf_tex}%
	}{X\rule[0ex]{0pt}{1pt}}%
}
\newcommand{\one}{\usebox{\onebox}}

\newsavebox{\twobox}	
\savebox{\twobox}{\scalerel*{%
	\def\svgwidth{2 pt}%
	\import{symbols/}{two.pdf_tex}%
	}{X\rule[0ex]{0pt}{1pt}}%
}
\newcommand{\two}{\usebox{\twobox}}

\newsavebox{\threebox}	
\savebox{\threebox}{\scalerel*{%
	\def\svgwidth{2 pt}%
	\import{symbols/}{three.pdf_tex}%
	}{X\rule[0ex]{0pt}{1pt}}%
}
\newcommand{\three}{\usebox{\threebox}}

\newsavebox{\fourbox}	
\savebox{\fourbox}{\scalerel*{%
	\def\svgwidth{2 pt}%
	\import{symbols/}{four.pdf_tex}%
	}{X\rule[0ex]{0pt}{1pt}}%
}
\newcommand{\four}{\usebox{\fourbox}}

\newsavebox{\fivebox}	
\savebox{\fivebox}{\scalerel*{%
	\def\svgwidth{2 pt}%
	\import{symbols/}{five.pdf_tex}%
	}{X\rule[0ex]{0pt}{1pt}}%
}
\newcommand{\five}{\usebox{\fivebox}}

\newsavebox{\blankbox}	
\savebox{\blankbox}{\scalerel*{%
	\def\svgwidth{2 pt}%
	\import{symbols/}{blank.pdf_tex}%
	}{X\rule[0ex]{0pt}{1pt}}%
}
\newcommand{\blank}{\usebox{\blankbox}}

% Small symbols
\newsavebox{\smallredbox}
\savebox{\smallredbox}{\tiny \scalerel*{%
	\def\svgwidth{1 pt}%
	\import{symbols/}{red.pdf_tex} }{X\rule[0ex]{0pt}{1pt}}%
}
\newcommand{\smallred}{\usebox{\smallredbox}}

\newsavebox{\smallyellowbox}
\savebox{\smallyellowbox}{\tiny \scalerel*{%
	\def\svgwidth{1 pt}%
	\import{symbols/}{yellow.pdf_tex} }{X\rule[0ex]{0pt}{1pt}}%
}
\newcommand{\smallyellow}{\usebox{\smallyellowbox}}

\newsavebox{\smallgreenbox}
\savebox{\smallgreenbox}{\tiny \scalerel*{%
	\def\svgwidth{1 pt}%
	\import{symbols/}{green.pdf_tex} }{X\rule[0ex]{0pt}{1pt}}%
}
\newcommand{\smallgreen}{\usebox{\smallgreenbox}}

\newsavebox{\smallbluebox}
\savebox{\smallbluebox}{\tiny \scalerel*{%
	\def\svgwidth{1 pt}%
	\import{symbols/}{blue.pdf_tex} }{X\rule[0ex]{0pt}{1pt}}%
}
\newcommand{\smallblue}{\usebox{\smallbluebox}}

\newsavebox{\smallpurplebox}	
\savebox{\smallpurplebox}{\tiny \scalerel*{%
	\def\svgwidth{1 pt}%
	\import{symbols/}{purple.pdf_tex} }{X\rule[0ex]{0pt}{1pt}}%
}
\newcommand{\smallpurple}{\usebox{\smallpurplebox}}

\newsavebox{\smalltealbox}	
\savebox{\smalltealbox}{\tiny \scalerel*{%
	\def\svgwidth{1 pt}%
	\import{symbols/}{teal.pdf_tex} }{X\rule[0ex]{0pt}{1pt}}%
}
\newcommand{\smallteal}{\usebox{\smalltealbox}}

\newsavebox{\smallblackbox}
\savebox{\smallblackbox}{\tiny \scalerel*{%
	\def\svgwidth{1 pt}%
	\import{symbols/}{black.pdf_tex} }{X\rule[0ex]{0pt}{1pt}}%
}
\newcommand{\smallblack}{\usebox{\smallblackbox}}

\newsavebox{\smallwhitebox}		
\savebox{\smallwhitebox}{\tiny \scalerel*{%
	\def\svgwidth{1 pt}%
	\import{symbols/}{white.pdf_tex} }{X\rule[0ex]{0pt}{1pt}}%
}
\newcommand{\smallwhite}{\usebox{\smallwhitebox}}

\newsavebox{\smallrainbowbox}	
\savebox{\smallrainbowbox}{\tiny \scalerel*{%
	\def\svgwidth{1 pt}%
	\import{symbols/}{rainbow.pdf_tex} }{X\rule[0ex]{0pt}{1pt}}%
}
\newcommand{\smallrainbow}{\usebox{\smallrainbowbox}}

\newsavebox{\smallzerobox}
\savebox{\smallzerobox}{\tiny \scalerel*{%
	\def\svgwidth{1 pt}%
	\import{symbols/}{zero.pdf_tex} }{X\rule[0ex]{0pt}{1pt}}%
}
\newcommand{\smallzero}{\usebox{\smallzerobox}}

\newsavebox{\smallonebox}	
\savebox{\smallonebox}{\tiny \scalerel*{%
	\def\svgwidth{1 pt}%
	\import{symbols/}{one.pdf_tex} }{X\rule[0ex]{0pt}{1pt}}%
}
\newcommand{\smallone}{\usebox{\smallonebox}}

\newsavebox{\smalltwobox}	
\savebox{\smalltwobox}{\tiny \scalerel*{%
	\def\svgwidth{1 pt}%
	\import{symbols/}{two.pdf_tex} }{X\rule[0ex]{0pt}{1pt}}%
}
\newcommand{\smalltwo}{\usebox{\smalltwobox}}

\newsavebox{\smallthreebox}	
\savebox{\smallthreebox}{\tiny \scalerel*{%
	\def\svgwidth{1 pt}%
	\import{symbols/}{three.pdf_tex} }{X\rule[0ex]{0pt}{1pt}}%
}
\newcommand{\smallthree}{\usebox{\smallthreebox}}

\newsavebox{\smallfourbox}	
\savebox{\smallfourbox}{\tiny \scalerel*{%
	\def\svgwidth{1 pt}%
	\import{symbols/}{four.pdf_tex} }{X\rule[0ex]{0pt}{1pt}}%
}
\newcommand{\smallfour}{\usebox{\smallfourbox}}

\newsavebox{\smallfivebox}	
\savebox{\smallfivebox}{\tiny \scalerel*{%
	\def\svgwidth{1 pt}%
	\import{symbols/}{five.pdf_tex} }{X\rule[0ex]{0pt}{1pt}}%
}
\newcommand{\smallfive}{\usebox{\smallfivebox}}

\newsavebox{\smallblankbox}	
\savebox{\smallblankbox}{\tiny \scalerel*{%
	\def\svgwidth{1 pt}%
	\import{symbols/}{blank.pdf_tex} }{X\rule[0ex]{0pt}{1pt}}%
}
\newcommand{\smallblank}{\usebox{\smallblankbox}}

\pgfkeys{/card/options/.is family}
\newcommand{\cardsetup}[1]{\pgfkeys{/card/options, #1}}

\pgfkeys{/card/options,
	color/.default = X,
	color/.is choice,
	color/X/.code = {%
		\def \csymbol {\!}%
		\def \smallcsymbol {\!}%
		},
	color/R/.code = {%
		\def \csymbol {\red}%
		\def \smallcsymbol {\smallred}%
		},
	color/Y/.code = {%
		\def \csymbol {\yellow}%
		\def \smallcsymbol {\smallyellow}%
		},
	color/G/.code = {%
		\def \csymbol {\green}%
		\def \smallcsymbol {\smallgreen}%
		},
	color/B/.code = {%
		\def \csymbol {\blue}%
		\def \smallcsymbol {\smallblue}%
		},
	color/P/.code = {%
		\def \csymbol {\purple}%
		\def \smallcsymbol {\smallpurple}%
		},
	color/T/.code = {%
		\def \csymbol {\teal}%
		\def \smallcsymbol {\smallteal}%
		},
	color/K/.code = {%
		\def \csymbol {\black}%
		\def \smallcsymbol {\smallblack}%
		},
	color/W/.code = {%
		\def \csymbol {\white}%
		\def \smallcsymbol {\smallwhite}%
		},
	color/M/.code = {%
		\def \csymbol {\rainbow}%
		\def \smallcsymbol {\smallrainbow}%
		},
	}

\pgfkeys{/card/options,
	number/.default = X,
	number/.is choice,
	number/X/.code = {%
		\def \nsymbol {\!}%
		\def \smallnsymbol {\!}%
		},
	number/0/.code = {%
		\def \nsymbol {\zero}%
		\def \smallnsymbol {\smallzero}%
		},
	number/1/.code = {%
		\def \nsymbol {\one}%
		\def \smallnsymbol {\smallone}%
		},
	number/2/.code = {%
		\def \nsymbol {\two}%
		\def \smallnsymbol {\smalltwo}%
		},
	number/3/.code = {%
		\def \nsymbol {\three}%
		\def \smallnsymbol {\smallthree}%
		},
	number/4/.code = {%
		\def \nsymbol {\four}%
		\def \smallnsymbol {\smallfour}%
		},
	number/5/.code = {%
		\def \nsymbol {\five}%
		\def \smallnsymbol {\smallfive}%
		},
	}

\pgfkeys{/card/options,	
	colorclue/.default = false,
	colorclue/.is choice,
	colorclue/true/.code = {%
		\def \cclue {(0.08, 0.35) node {\smallcsymbol}}%
		\def \bordercolor {orange}%
	},
	colorclue/false/.code = {%
		\def \cclue {(0.08, 0.35) node {\smallblank}}%
		\def \bordercolor {black}%
	},
	numberclue/.default = false,
	numberclue/.is choice,
	numberclue/true/.code = {%
		\def \nclue {(-0.08, 0.35) node {\smallnsymbol}}%
		\def \bordercolor {orange}%
	},
	numberclue/false/.code = {%
		\def \nclue {(-0.08, 0.35) node {\smallblank}}%
		\def \bordercolor {black}%
	},	
	finessed/.default = false,
	finessed/.is choice,
	finessed/true/.code = {%
		\def \bordercolor {aqua}%
	},
	finessed/false/.code = {},
	chopmoved/.default = false,
	chopmoved/.is choice,
	chopmoved/true/.code = {%
		\def \bordercolor {cream}%
	},
	chopmoved/false/.code = {},
	c/.value forbidden,
	c/.style = {colorclue = true},
	n/.value forbidden,
	n/.style = {numberclue = true},
	cn/.value forbidden,
	cn/.style = {colorclue = true, numberclue = true},
	nc/.value forbidden,
	nc/.style = {colorclue = true, numberclue = true},	
	f/.value forbidden,
	f/.style = {finessed = true},
	cm/.value forbidden,
	cm/.style = {chopmoved = true},
}

\newcommand{\CARD}[2][]{%
	\raisebox{-2 pt}{%
		\begin{tikzpicture}
			\StrLeft{#2}{1}[\@@color]
			\StrRight{#2}{1}[\@@number]
			\cardsetup{#1, color=\@@color, number=\@@number}
			\draw[\bordercolor, line width = 0.9 pt] (-0.36, -0.24) rectangle (0.36, 0.24)
			(0,0) node {\nsymbol \! \csymbol}
			\cclue \nclue;
			\carddefault
		\end{tikzpicture}%
	}%
}

\newcommand{\C}[1]{%
	\StrLeft{#1}{1}[\@@color]%
	\StrRight{#1}{1}[\@@number]%
	\cardsetup{color=\@@color, number=\@@number}%
	\nsymbol\,\csymbol%
	\carddefault%
}

\newcommand{\carddefault}{%
	\cardsetup{color, number, colorclue, numberclue, finessed, chopmoved}%
	}%
\carddefault
\ProcessPgfPackageOptions{/card/options}

\endinput